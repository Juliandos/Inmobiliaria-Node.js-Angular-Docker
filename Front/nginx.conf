# ============================================
# Configuración de Nginx para Angular
# ============================================
#
# ¿QUÉ ES NGINX?
# --------------
# Nginx es un servidor web ligero y rápido que sirve archivos estáticos.
# En producción, Angular compila a archivos estáticos (HTML, CSS, JS)
# y nginx los sirve.
#
# ¿POR QUÉ ESTA CONFIGURACIÓN?
# -----------------------------
# Angular es una SPA (Single Page Application), lo que significa que
# todas las rutas deben redirigirse al index.html para que el router
# de Angular funcione correctamente.
#
# ============================================

server {
    # Escuchar en el puerto 80 (puerto por defecto de HTTP)
    listen 80;
    
    # Nombre del servidor (opcional)
    server_name localhost;
    
    # Directorio raíz donde están los archivos compilados
    root /usr/share/nginx/html;
    
    # Archivo índice por defecto
    index index.html;
    
    # Configuración de compresión (hace que los archivos se transfieran más rápido)
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    
    # Configuración para archivos estáticos
    location / {
        # Intentar servir el archivo solicitado
        # Si no existe, intentar como directorio
        # Si tampoco existe, servir index.html (para rutas de Angular)
        try_files $uri $uri/ /index.html;
        
        # Headers de seguridad
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
    
    # Cache para archivos estáticos (JS, CSS, imágenes)
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # No cachear index.html (siempre debe ser fresco)
    location = /index.html {
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
}


