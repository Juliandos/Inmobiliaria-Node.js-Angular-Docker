<!-- Header con botón -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>Gestión de Tipos de Propiedad</h2>
  <button 
    mat-raised-button 
    color="primary" 
    (click)="toggleCreateForm()"
    class="d-flex align-items-center">
    <mat-icon class="me-2">add</mat-icon>
    {{ showCreateForm ? 'Cancelar' : 'Nuevo Tipo' }}
  </button>
</div>

<!-- Formulario Crear -->
<mat-card *ngIf="showCreateForm" class="mb-4">
  <mat-card-header>
    <mat-card-title>Crear Nuevo Tipo</mat-card-title>
  </mat-card-header>
  <mat-card-content class="pt-3">
    <form [formGroup]="createForm" (ngSubmit)="onCreateTipo()">
      <mat-form-field appearance="outline" class="w-100 mb-3">
        <mat-label>Nombre*</mat-label>
        <input matInput formControlName="nombre" placeholder="Apartamento">
        <mat-error *ngIf="createForm.get('nombre')?.hasError('required')">
          El nombre es requerido
        </mat-error>
      </mat-form-field>
      <div class="d-flex gap-2">
        <button mat-raised-button color="primary" type="submit" [disabled]="createForm.invalid">
          <mat-icon class="me-2">save</mat-icon>
          Crear Tipo
        </button>
        <button mat-button type="button" (click)="toggleCreateForm()">Cancelar</button>
      </div>
    </form>
  </mat-card-content>
</mat-card>

<!-- Formulario Editar -->
<mat-card *ngIf="showEditForm" class="mb-4">
  <mat-card-header>
    <mat-card-title>Editar Tipo</mat-card-title>
  </mat-card-header>
  <mat-card-content class="pt-3">
    <form [formGroup]="editForm" (ngSubmit)="onUpdateTipo()">
      <mat-form-field appearance="outline" class="w-100 mb-3">
        <mat-label>Nombre*</mat-label>
        <input matInput formControlName="nombre">
        <mat-error *ngIf="editForm.get('nombre')?.hasError('required')">
          El nombre es requerido
        </mat-error>
      </mat-form-field>
      <div class="d-flex gap-2">
        <button mat-raised-button color="primary" type="submit" [disabled]="editForm.invalid">
          <mat-icon class="me-2">update</mat-icon>
          Actualizar Tipo
        </button>
        <button mat-button type="button" (click)="cancelEdit()">Cancelar</button>
      </div>
    </form>
  </mat-card-content>
</mat-card>

<!-- Campo de filtro -->
<mat-form-field appearance="outline" class="mb-3 w-100">
  <mat-label>Filtrar tipos</mat-label>
  <input matInput [formControl]="filterControl" placeholder="Buscar por nombre o ID">
  <mat-icon matPrefix>search</mat-icon>
</mat-form-field>

<!-- Tabla -->
<div class="mat-elevation-z8">
  <table mat-table [dataSource]="filteredTipos" class="w-100">
    
    <!-- ID -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef class="fw-bold">ID</th>
      <td mat-cell *matCellDef="let tipo">{{ tipo.id }}</td>
    </ng-container>

    <!-- Nombre -->
    <ng-container matColumnDef="nombre">
      <th mat-header-cell *matHeaderCellDef class="fw-bold">Nombre</th>
      <td mat-cell *matCellDef="let tipo">
        <strong>{{ tipo.nombre }}</strong>
      </td>
    </ng-container>

    <!-- Acciones -->
    <ng-container matColumnDef="acciones">
      <th mat-header-cell *matHeaderCellDef class="fw-bold">Acciones</th>
      <td mat-cell *matCellDef="let tipo">
        <div class="d-flex gap-1">
          <button 
            mat-icon-button 
            color="primary" 
            (click)="onEditTipo(tipo)"
            matTooltip="Editar tipo">
            <mat-icon>edit</mat-icon>
          </button>
          <button 
            mat-icon-button 
            color="warn" 
            (click)="onDeleteTipo(tipo.id)"
            matTooltip="Eliminar tipo"
            *hasPermission="{ modulo: 'tipos_propiedad', operacion: 'd' }"
            >
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

  <!-- Mensaje vacío -->
  <div *ngIf="filteredTipos.length === 0" class="text-center p-4">
    <mat-icon class="text-muted" style="font-size: 48px;">category</mat-icon>
    <p class="text-muted mt-2">No se encontraron tipos de propiedad</p>
  </div>
</div>
